## Мотивация

На данный момент у нас существует два типа коллекций: `Bag` и `Array`. Типичным примером `Bag` являются аттрибуты класса, примером `Array` комментарии в `Thread`.
В текущем дизайне и `Array` и `Bag` явлюятся составной частью родительского объекта, что вызывает следующие проблемы и неудобства:

* Родительский объект может быть очень большим: сейчас мы не можем взаимодействовать с отдельными объектами в коллекциях, а только загрузить родительский объект целиком.
* Пользователь не может подписаться на изменения в коллекциях. Представим, что я хочу показывать комментарии: логично было бы подписаться на коллекцию с комментариями и
обновлять интерфейс соответствующим образом. Вместо этого мне приходит сообщение об изменении всего родительского объекта.
* Гранулярность: я не могу просто и красиво узнать о том что, например, в коллекцию добавился новый комментарий, или новое состояние State Machine. Вместо этого мне прилетит изменкние всего родительского объекта, возможно там есть уточняющие параметры, которые мне нужно как то разобрать чтобы понять что произошло, но я хочу иметь четкие события, говорящие о том что
добавился комментарий или удалился аттрибут.
* Идентификация: пользователь не может сослаться на объект в коллекции. На данном этапе развития плафтормы еще не ясно насколько это важно или не важно.

## Дизайн

Предлагается следующее:
* Ввести тип `Collection`. Запросы к хранилищу будут возвращать объекты `Collection` для работы с коллекциями вместо реальных значений как это сделано сейчас.
* Ввести транзакции по работе с коллекциями. `TxAddItem`, и так далее.
* Коллекции могут хранить только `Emb` объекты. Ограничить тип аттрибута `Emb` объекта примитивными типами, таким образом `Emb` типы не могут содержать другие коллекции.
* Вместо двух типов `Bag` и `Array` оставить один. Я предлагаю `Bag` или `Collection` (`Array` может пригодиться в дальнейшем).
* `Emb` объекты могут иметь опциональные локальные (в пределах коллекции) идентификаторы. Пример: имена аттрибутов класса, которые логично иметь соответствующими именам аттрибутов определенных в коде, и генерировать для созданных во время исполнения имен аттрибутов. Может быть даже не опциональные.

## Физическое хранение коллекций

Данное предложение говорит только о том как пользователь будет работать с данными. Физически `Emb` объекты коллекций могут храниться как угодно умно или глупо. В случае с моделью имеет смысл хранить коллекции составной частью родительского объекта. В случае с mongodb это может быть умное хранение: небольшие коллекции храняться составной частью родительского объекта, большие, как first class objects (это воможно глупый пример, который усложнит поиск и/или сделает его неэффективным). Хранилище в реляционной базе сохраняет `Emb` объекты в отдельных таблицах.

